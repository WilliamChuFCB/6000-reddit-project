---
title: "ML - Reddit Data about Soccer"
author:
  - name: Jingda Yang, Wendi Chu, Haiyu Xiao, Tingsong Li

execute:
  echo: false

format:
  html:
    embed-resources: true
    self-contained: true
    page-layout: full
    fig-cap-location: bottom
    toc: true
    toc-location: left
    toc-title: Contents
---



- Topics:

  1. 
  - Business Goal: Predict the popularity of reddit Posts in soccer subreddit with various factors.
  - Technical Proposal: Gather Reddit posts from a soccer subreddit. Establish a processing pipeline to vectorize and train the dataset with different factors related to the post. Use pyspark machine learning package to train a random forest classifier to predict if a post can have more than 20 posts using a grid map and cross validation. Apply the trained model to the test set for prediction and get the feature importance and visualize the results using a bar plot.

  2. 
  - Business Goal: Predict the controversiality of social media posts using their textual content and user engagement scores.
  - Technical Proposal: Implement a machine learning model that integrates NLP to analyze the body and numerical analysis of engagement scores. Utilize logistic regression to categorize posts into controversial or non-controversial, leveraging insights about the relationship between content and user interactions.

  1. 


## Executive summary

### Business Goal 1:

The study predicts the popularity of posts in soccer subreddit with accuracy higher than 88%. It reveals that factor score stands out of other factors. Other factors such as title length and number of crossposts also play a role in determine the popularity but publish time and adult contents are not helpful for predictions.

### Business Goal 2:

Predict the controversiality of social media posts using their textual content and user engagement scores. This study offers a tool to help determine what kinds of posts typically trigger a lot of debate and conversation. This can be helpful for online forums that want to control or monitor content that might trigger argumentative debates.

### Business Goal 3:



## Analysis report

### Business Goal 1: Predict the popularity of reddit Posts in soccer subreddit with various factors.

In this study, we aim to develop a machine learning model that predicts the popularity of Reddit posts based on various factors, with popularity defined as receiving more than 20 comments per post. This model is intended to identify key factors that contribute to increasing comment activity, serving as a guide for Reddit users to enhance the popularity of their posts. Our chosen methodology utilizes the random forest classifier, implemented through the "pyspark.ml" package. The process began with the collection of submission data from the soccer subreddit. Key features included in the analysis were post length and a binary indicator for nighttime posting. A pipeline was established to vectorize the training data and to construct the random forest model. Grid search and cross-validation techniques were employed to optimize the model, leading to the selection of a random forest model with 50 trees and a maximum depth of 15. The model demonstrated a high level of accuracy, achieving a test accuracy of 0.8893. In terms of feature importance, which is based on the reduction in impurity, the 'score' factor (likes minus dislikes) emerged as the most influential. Secondary factors, such as the number of crossposts and title length, had a significant but lesser impact. Other contributing factors included posts authored by administrators, those containing videos, or with enabled previews, each showing a moderate increase in popularity. Conversely, the time of publishing and the presence of adult content were found to be less influential in determining post popularity.

```{python, echo=FALSE}
#| label: fig-polar1
#| fig-cap: Feature Importance
from PIL import Image
with Image.open("../../data/plots/feature_importance.png") as img1:
    display(img1)
```

In terms of feature importance, which is based on the reduction in impurity, the 'score' factor (likes minus dislikes) emerged as the most influential. Secondary factors, such as the number of crossposts and title length, had a significant but lesser impact. Other contributing factors included posts authored by administrators, those containing videos, or with enabled previews, each showing a moderate increase in popularity. Conversely, the time of publishing and the presence of adult content were found to be less influential in determining post popularity.

### Business Goal 2: Predict the controversiality of social media posts using their textual content and user engagement scores.

The Business goal and Technical proposal have changed a bit from the previous one. The original Business goal was **Determine the topics and key words which make a post more controversial**. Here only the body and score were used to predict controversy and logistic regression was used. The logistic regression approach provided a clear baseline with the advantage of interpretability. Initially, the data was filtered out and the body of each post was converted from list to vector, next developed two logistic regression models with distinct hyperparameter configurations.

* Model 1: Featured a regularization parameter (regParam) of 0.1 and a maximum iteration count (maxIter) of 10.
* Model 2: Had a regParam of 0.01 and maxIter of 20.

The models were evaluated on several metrics: **ROC AUC, Accuracy, F1 Score, Confusion Matrix.**
```{python, echo=FALSE}
#| label: tbl-planets2
#| tbl-cap: Classification Report for Test Data
import pandas as pd
df = pd.read_csv('../../data/csv/model_metrics_controversial.csv', index_col=0)
df = df.head()
df
```


```{python, echo=FALSE}
#| label: fig-polar3
#| fig-cap: "Confusion Matrix for Model 1 and Model 2"
#| fig-subcap: 
#|   - "Confusion Matrix for Model 1"
#|   - "Confusion Matrix for Model 2"
#| layout-ncol: 2
from PIL import Image
with Image.open("../../data/plots/model_1_cm.png") as img:
    display(img)
with Image.open("../../data/plots/model_2_cm.png") as img2:
    display(img2)
```

From Table 1 and Figure 2, model 1 has proven to be more effective in reducing false positives. Therefore model 1 is more suitable for avoiding the mislabeling of uncontested posts. Model 1 also has a higher ROC AUC score, Accuracy, and F1 score.
  
Model 1 is more effective at reducing false positives and is therefore suitable for avoiding mislabeling non-controversial posts.
Model 2 is more sensitive to controversial posts and may be more useful when missing controversial posts could have a significant impact.
  
The models can guide content management strategies, and provide information for user engagement strategies. The models can also identify controversial content based on text analytics, which may help categorize the management of posts in forums.
  
### Business Goal 3: 